<template><h3 id="作者-放荡不羁的bug" tabindex="-1"><a class="header-anchor" href="#作者-放荡不羁的bug" aria-hidden="true">#</a> 作者：放荡不羁的bug</h3>
<h2 id="前述" tabindex="-1"><a class="header-anchor" href="#前述" aria-hidden="true">#</a> 前述</h2>
<p>在项目需求中，我们常常能够遇到需要实时获取状态的需求，例如获取某某任务是否完成状态，或者当其他用户做出操作时，界面需要实时提醒，这些需求通常需要我们实时地从后台取得当前状态，但由于 <code>HTTP</code> 请求是单向的（只能由客户端发起），所以通常使用轮询的方式去获取最新状态，这样的获取方式需要一直发送请求，无端增大浏览器与服务器性能消耗，明显不是很好的解决方案，本文将会介绍通过介绍及简单实现 <code>SSE</code>及 <code>WebSoket</code>  两种方案介绍非轮询式动态数据获取方案。</p>
<h2 id="技术介绍" tabindex="-1"><a class="header-anchor" href="#技术介绍" aria-hidden="true">#</a> 技术介绍</h2>
<h3 id="websoket" tabindex="-1"><a class="header-anchor" href="#websoket" aria-hidden="true">#</a> WebSoket</h3>
<p><code>WebSoket</code> 是前端比较常见的技术，其通过独立端口与服务器连接，实现服务器与客户端全双工通信，能够更好的节省服务器资源及带宽，连接时客户端主动发起 <code>WebSoket</code> 连接请求，连接后服务器与客户端可双向通信，如想关闭连接，客户端也可发送连接主动关闭请求，当前 <code>node</code> 实现 <code>WebSoket</code> 工具有很多，例如：<code>WebSocket-Node</code> 、<code>faye-websocket-node</code> 、<code>socket.io</code> ，接下来我将会使用<code>socket.io</code> 实现 <code>WebSoket</code> 后端推送及前后端交互，通过实现一个简单的实时交流页面展示 <code>WebSoket</code> 双向通信特性。</p>
<h4 id="准备" tabindex="-1"><a class="header-anchor" href="#准备" aria-hidden="true">#</a> 准备</h4>
<p>首先我们需要构建后端框架，在这里我使用的是 <code>Express</code> ，大家可以自己参照 <a href="https://www.expressjs.com.cn/" target="_blank" rel="noopener noreferrer">Express官网<OutboundLink/></a> 构建框架，也可以跟着下面的指令构建。</p>
<p>创建项目文件夹，叫什么随意，我取名为 <code>websoketNode</code></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">mkdir</span> websoketNode
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>进入文件夹后执行项目初始化命令，配置项全部默认就行，创建结束后可看到文件夹内 <code>package.json</code> 文件</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> websoketNode
<span class="token function">npm</span> init
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>项目引入 <code>Express</code> ，使用脚手架生成 <code>Express</code> 骨架</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> express --save
npx express-generator
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>生成骨架可能会提示下载 <code>express-generator</code> 依赖，确认即可</p>
<p>构建完成后，生成目录架构如下所示：</p>
<p><img src="https://i.loli.net/2021/10/13/OKnfMJtHwuqkgho.png" alt="menu"></p>
<p><code>Express</code> 启动后默认访问地址为 <code>http://localhost:3000/</code> ，进入界面可见：</p>
<p><img src="https://i.loli.net/2021/10/13/rfVtlMWSzYeCcJP.png" alt="image-2021091016074609"></p>
<p>引入 <code>soket.io</code> 依赖</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> socket.io
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>打开 <code>index.js</code> 文件，创建服务，引入 <code>socket.io</code> ，监听端口为 <code>3001</code> ，添加 <code>socket</code> 监听及允许请求跨域：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建soket</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> soket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'socket.io'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> io <span class="token operator">=</span> <span class="token function">soket</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token punctuation">{</span> cors<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// socket相关监听都要放在这个回调里</span>
io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a user connected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 断开连接时打印</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"disconnect"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"a user go out"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 每隔3秒钟发送一次信息</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        io<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"data: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'来自Soket后端的推送'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 接收信息，并返回所发送的消息</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        io<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">'你发送了信息：'</span> <span class="token operator">+</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//开启端口监听socket</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>这样 <code>WebSoket</code> 后端逻辑就完成了，<code>WebSoket</code> 每三秒钟发送一次信息，在接收前端发送的消息后，将消息返回至前端</p>
<p>前端框架就不详细描述了，大家可以参照官网去搭建，接下来我们开始实现前端的 <code>WebSoket</code> 连接</p>
<p>首先引入 <code>socket.io</code> 包：</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> socket.io-client --save
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>界面引入 <code>socket.io</code> ，创建 <code>WebSoket</code> 连接，将后端发送内容拼接后展示（注：界面销毁时需要将连接关闭，后端无法自动销毁）：</p>
<p>连接 <code>WebSoket</code> 代码：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token string">'ws://127.0.0.1:3001'</span><span class="token punctuation">)</span> <span class="token comment">// 建立链接</span>
<span class="token comment">// 监听服务端的消息“msg”</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>showContent <span class="token operator">=</span> that<span class="token punctuation">.</span>showContent <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">+</span> data
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>web</code> 代码：</p>
<div class="language-vue ext-vue line-numbers-mode"><pre v-pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show-pre<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ showContent }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>启动前后端，进入界面即可获取到后端三秒传过来的时间信息：</p>
<p><img src="https://i.loli.net/2021/10/13/L5HSJvEi6jGsA39.png" alt="image-2021092614135448"></p>
<p>此时 <code>WebSoket</code> 已连接，接下来我们使用它完成一个聊天室</p>
<p>首先，我们在前端框架内引入 <code>element</code> 框架，引用流程请见 <a href="https://element.eleme.cn/#/zh-CN/component/quickstart" target="_blank" rel="noopener noreferrer">element官网<OutboundLink/></a></p>
<p>通过样式组件，我们优化我们的聊天室：</p>
<div class="language-vue ext-vue line-numbers-mode"><pre v-pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-card</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box-card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>聊天室<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 3px 0</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>退出聊天<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in messageList<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.key<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.type === <span class="token punctuation">'</span>sendMessage<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name-image<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name | nameFilter }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name }}：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">effect</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>plain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.type === <span class="token punctuation">'</span>tip<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name }} 已进入群聊<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">clear</span><span class="token punctuation">:</span>both</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-container<span class="token punctuation">"</span></span> <span class="token attr-name">:gutter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.enter.native</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendMessage<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请输入内容<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendMessage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-card</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>less<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
    <span class="token selector">.container</span> <span class="token punctuation">{</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 39%<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
        <span class="token selector">.message-container</span> <span class="token punctuation">{</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
            <span class="token selector">.message-item</span> <span class="token punctuation">{</span>
                <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
                <span class="token property">width</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span>
                <span class="token property">margin</span><span class="token punctuation">:</span> 4px 0px<span class="token punctuation">;</span>
                <span class="token selector">.image-left</span> <span class="token punctuation">{</span>
                    <span class="token property">flex</span><span class="token punctuation">:</span> 0 40px<span class="token punctuation">;</span>
                    <span class="token selector">.name-image</span> <span class="token punctuation">{</span>
                        <span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
                        <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
                        <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
                        <span class="token property">background-color</span><span class="token punctuation">:</span> #037df3<span class="token punctuation">;</span>
                        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
                        <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
                        <span class="token property">line-height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
                        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token selector">.text-right</span> <span class="token punctuation">{</span>
                    <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
                    <span class="token selector">.name</span> <span class="token punctuation">{</span>
                        <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
                        <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token selector">.text</span> <span class="token punctuation">{</span>
                        <span class="token property">color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token selector">.my-message</span> <span class="token punctuation">{</span>
                <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
                <span class="token property">flex-direction</span><span class="token punctuation">:</span> row-reverse<span class="token punctuation">;</span>
                <span class="token property">padding-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
                <span class="token selector">.image-left</span> <span class="token punctuation">{</span>
                    <span class="token selector">.name-image</span> <span class="token punctuation">{</span>
                        <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token selector">.text-right</span> <span class="token punctuation">{</span>
                    <span class="token selector">.name</span> <span class="token punctuation">{</span>
                        <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token selector">.text</span> <span class="token punctuation">{</span>
                        <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token selector">.tip</span> <span class="token punctuation">{</span>
                <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
                <span class="token property">margin</span><span class="token punctuation">:</span> 4px 0px<span class="token punctuation">;</span>
                <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
                <span class="token property">color</span><span class="token punctuation">:</span> #BDBDBD<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.button-container</span> <span class="token punctuation">{</span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">::-webkit-scrollbar</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token comment">/*对垂直流动条有效*/</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token comment">/*对水平流动条有效*/</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/*定义滑块颜色、内阴影及圆角*/</span>
        <span class="token selector">::-webkit-scrollbar-thumb</span><span class="token punctuation">{</span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span>
            <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> inset 0 0 6px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>.3<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> #E8E8E8<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br></div></div><p>此时我们得到的界面如下：</p>
<p><img src="https://i.loli.net/2021/10/13/QHufBrbM9OlPoRL.png" alt="image-2021100818534093"></p>
<p>在进入界面时，我们需要自定义创建一个姓名，创建方法网上可以找到很多，后面代码中也会给出。</p>
<p>我们在 <code>mounted</code> 时调用生成名字：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>myName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRandomName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>当我们进入聊天室的时候，需要向所有人发送一个进入的提示，为了与信息做区分，我们定义消息类型为 <code>tip</code> ，代码如下：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>myName<span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'tip'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>当然，此时后端信息接收及发送也需要修改，删除间隔的发送消息：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a user connected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 断开连接时打印</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"disconnect"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"a user go out"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 每隔3秒钟发送一次信息</span>
    <span class="token comment">// setInterval(() => {</span>
    <span class="token comment">//   io.emit("msg", "data: " + ('来自Soket后端的推送' + new Date()));</span>
    <span class="token comment">// }, 3000);</span>

    <span class="token comment">// 接收信息</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        io<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>而当我们发送消息时，也定义一个类型为 <code>sendMessage</code> 表示这是使用者发出的信息：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// 发送信息</span>
<span class="token function">sendMessage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>
            key<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>myName<span class="token punctuation">,</span>
            message<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">'sendMessage'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>当我们接收到消息时，只需要将接收到的数据推入消息列表中，界面根据类型渲染即可：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// 监听服务端的消息“msg”</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>完成后代码如下：</p>
<div class="language-vue ext-vue line-numbers-mode"><pre v-pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-card</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box-card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>聊天室<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 3px 0</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>退出聊天<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in messageList<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.key<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.type === <span class="token punctuation">'</span>sendMessage<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name-image<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name | nameFilter }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name }}：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">effect</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>plain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.type === <span class="token punctuation">'</span>tip<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name }} 已进入群聊<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">clear</span><span class="token punctuation">:</span>both</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-container<span class="token punctuation">"</span></span> <span class="token attr-name">:gutter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.enter.native</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendMessage<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请输入内容<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendMessage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-card</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> io <span class="token keyword">from</span> <span class="token string">'socket.io-client'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'WebSocket'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      socket<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// soket连接实例</span>
      myName<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 我的名字</span>
      message<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 发送信息</span>
      messageList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 信息列表</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  filters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">nameFilter</span> <span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRandomName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connectSoket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 连接soket接收信息</span>
    <span class="token function">connectSoket</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token string">'ws://127.0.0.1:3001'</span><span class="token punctuation">)</span> <span class="token comment">// 建立链接</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>
          key<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>myName<span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'tip'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 监听服务端的消息“msg”</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 发送信息</span>
    <span class="token function">sendMessage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>
          key<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>myName<span class="token punctuation">,</span>
          message<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'sendMessage'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 获取随机姓名</span>
    <span class="token function">getRandomName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> firstNames <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'赵'</span><span class="token punctuation">,</span> <span class="token string">'钱'</span><span class="token punctuation">,</span> <span class="token string">'孙'</span><span class="token punctuation">,</span> <span class="token string">'李'</span><span class="token punctuation">,</span> <span class="token string">'周'</span><span class="token punctuation">,</span> <span class="token string">'吴'</span><span class="token punctuation">,</span> <span class="token string">'郑'</span><span class="token punctuation">,</span> <span class="token string">'王'</span><span class="token punctuation">,</span> <span class="token string">'冯'</span><span class="token punctuation">,</span> <span class="token string">'陈'</span><span class="token punctuation">,</span> <span class="token string">'楮'</span><span class="token punctuation">,</span> <span class="token string">'卫'</span><span class="token punctuation">,</span> <span class="token string">'蒋'</span><span class="token punctuation">,</span> <span class="token string">'沈'</span><span class="token punctuation">,</span> <span class="token string">'韩'</span><span class="token punctuation">,</span> <span class="token string">'杨'</span><span class="token punctuation">,</span>
        <span class="token string">'朱'</span><span class="token punctuation">,</span> <span class="token string">'秦'</span><span class="token punctuation">,</span> <span class="token string">'尤'</span><span class="token punctuation">,</span> <span class="token string">'许'</span><span class="token punctuation">,</span> <span class="token string">'何'</span><span class="token punctuation">,</span> <span class="token string">'吕'</span><span class="token punctuation">,</span> <span class="token string">'施'</span><span class="token punctuation">,</span> <span class="token string">'张'</span><span class="token punctuation">,</span> <span class="token string">'孔'</span><span class="token punctuation">,</span> <span class="token string">'曹'</span><span class="token punctuation">,</span> <span class="token string">'严'</span><span class="token punctuation">,</span> <span class="token string">'华'</span><span class="token punctuation">,</span> <span class="token string">'金'</span><span class="token punctuation">,</span> <span class="token string">'魏'</span><span class="token punctuation">,</span> <span class="token string">'陶'</span><span class="token punctuation">,</span> <span class="token string">'姜'</span><span class="token punctuation">,</span>
        <span class="token string">'戚'</span><span class="token punctuation">,</span> <span class="token string">'谢'</span><span class="token punctuation">,</span> <span class="token string">'邹'</span><span class="token punctuation">,</span> <span class="token string">'喻'</span><span class="token punctuation">,</span> <span class="token string">'柏'</span><span class="token punctuation">,</span> <span class="token string">'水'</span><span class="token punctuation">,</span> <span class="token string">'窦'</span><span class="token punctuation">,</span> <span class="token string">'章'</span><span class="token punctuation">,</span> <span class="token string">'云'</span><span class="token punctuation">,</span> <span class="token string">'苏'</span><span class="token punctuation">,</span> <span class="token string">'潘'</span><span class="token punctuation">,</span> <span class="token string">'葛'</span><span class="token punctuation">,</span> <span class="token string">'奚'</span><span class="token punctuation">,</span> <span class="token string">'范'</span><span class="token punctuation">,</span> <span class="token string">'彭'</span><span class="token punctuation">,</span> <span class="token string">'郎'</span><span class="token punctuation">,</span>
        <span class="token string">'鲁'</span><span class="token punctuation">,</span> <span class="token string">'韦'</span><span class="token punctuation">,</span> <span class="token string">'昌'</span><span class="token punctuation">,</span> <span class="token string">'马'</span><span class="token punctuation">,</span> <span class="token string">'苗'</span><span class="token punctuation">,</span> <span class="token string">'凤'</span><span class="token punctuation">,</span> <span class="token string">'花'</span><span class="token punctuation">,</span> <span class="token string">'方'</span><span class="token punctuation">,</span> <span class="token string">'俞'</span><span class="token punctuation">,</span> <span class="token string">'任'</span><span class="token punctuation">,</span> <span class="token string">'袁'</span><span class="token punctuation">,</span> <span class="token string">'柳'</span><span class="token punctuation">,</span> <span class="token string">'酆'</span><span class="token punctuation">,</span> <span class="token string">'鲍'</span><span class="token punctuation">,</span> <span class="token string">'史'</span><span class="token punctuation">,</span> <span class="token string">'唐'</span><span class="token punctuation">,</span>
        <span class="token string">'费'</span><span class="token punctuation">,</span> <span class="token string">'廉'</span><span class="token punctuation">,</span> <span class="token string">'岑'</span><span class="token punctuation">,</span> <span class="token string">'薛'</span><span class="token punctuation">,</span> <span class="token string">'雷'</span><span class="token punctuation">,</span> <span class="token string">'贺'</span><span class="token punctuation">,</span> <span class="token string">'倪'</span><span class="token punctuation">,</span> <span class="token string">'汤'</span><span class="token punctuation">,</span> <span class="token string">'滕'</span><span class="token punctuation">,</span> <span class="token string">'殷'</span><span class="token punctuation">,</span> <span class="token string">'罗'</span><span class="token punctuation">,</span> <span class="token string">'毕'</span><span class="token punctuation">,</span> <span class="token string">'郝'</span><span class="token punctuation">,</span> <span class="token string">'邬'</span><span class="token punctuation">,</span> <span class="token string">'安'</span><span class="token punctuation">,</span> <span class="token string">'常'</span><span class="token punctuation">,</span>
        <span class="token string">'乐'</span><span class="token punctuation">,</span> <span class="token string">'于'</span><span class="token punctuation">,</span> <span class="token string">'时'</span><span class="token punctuation">,</span> <span class="token string">'傅'</span><span class="token punctuation">,</span> <span class="token string">'皮'</span><span class="token punctuation">,</span> <span class="token string">'卞'</span><span class="token punctuation">,</span> <span class="token string">'齐'</span><span class="token punctuation">,</span> <span class="token string">'康'</span><span class="token punctuation">,</span> <span class="token string">'伍'</span><span class="token punctuation">,</span> <span class="token string">'余'</span><span class="token punctuation">,</span> <span class="token string">'元'</span><span class="token punctuation">,</span> <span class="token string">'卜'</span><span class="token punctuation">,</span> <span class="token string">'顾'</span><span class="token punctuation">,</span> <span class="token string">'孟'</span><span class="token punctuation">,</span> <span class="token string">'平'</span><span class="token punctuation">,</span> <span class="token string">'黄'</span><span class="token punctuation">,</span>
        <span class="token string">'和'</span><span class="token punctuation">,</span> <span class="token string">'穆'</span><span class="token punctuation">,</span> <span class="token string">'萧'</span><span class="token punctuation">,</span> <span class="token string">'尹'</span><span class="token punctuation">,</span> <span class="token string">'姚'</span><span class="token punctuation">,</span> <span class="token string">'邵'</span><span class="token punctuation">,</span> <span class="token string">'湛'</span><span class="token punctuation">,</span> <span class="token string">'汪'</span><span class="token punctuation">,</span> <span class="token string">'祁'</span><span class="token punctuation">,</span> <span class="token string">'毛'</span><span class="token punctuation">,</span> <span class="token string">'禹'</span><span class="token punctuation">,</span> <span class="token string">'狄'</span><span class="token punctuation">,</span> <span class="token string">'米'</span><span class="token punctuation">,</span> <span class="token string">'贝'</span><span class="token punctuation">,</span> <span class="token string">'明'</span><span class="token punctuation">,</span> <span class="token string">'臧'</span><span class="token punctuation">,</span>
        <span class="token string">'计'</span><span class="token punctuation">,</span> <span class="token string">'伏'</span><span class="token punctuation">,</span> <span class="token string">'成'</span><span class="token punctuation">,</span> <span class="token string">'戴'</span><span class="token punctuation">,</span> <span class="token string">'谈'</span><span class="token punctuation">,</span> <span class="token string">'宋'</span><span class="token punctuation">,</span> <span class="token string">'茅'</span><span class="token punctuation">,</span> <span class="token string">'庞'</span><span class="token punctuation">,</span> <span class="token string">'熊'</span><span class="token punctuation">,</span> <span class="token string">'纪'</span><span class="token punctuation">,</span> <span class="token string">'舒'</span><span class="token punctuation">,</span> <span class="token string">'屈'</span><span class="token punctuation">,</span> <span class="token string">'项'</span><span class="token punctuation">,</span> <span class="token string">'祝'</span><span class="token punctuation">,</span> <span class="token string">'董'</span><span class="token punctuation">,</span> <span class="token string">'梁'</span><span class="token punctuation">,</span>
        <span class="token string">'杜'</span><span class="token punctuation">,</span> <span class="token string">'阮'</span><span class="token punctuation">,</span> <span class="token string">'蓝'</span><span class="token punctuation">,</span> <span class="token string">'闽'</span><span class="token punctuation">,</span> <span class="token string">'席'</span><span class="token punctuation">,</span> <span class="token string">'季'</span><span class="token punctuation">,</span> <span class="token string">'麻'</span><span class="token punctuation">,</span> <span class="token string">'强'</span><span class="token punctuation">,</span> <span class="token string">'贾'</span><span class="token punctuation">,</span> <span class="token string">'路'</span><span class="token punctuation">,</span> <span class="token string">'娄'</span><span class="token punctuation">,</span> <span class="token string">'危'</span><span class="token punctuation">,</span> <span class="token string">'江'</span><span class="token punctuation">,</span> <span class="token string">'童'</span><span class="token punctuation">,</span> <span class="token string">'颜'</span><span class="token punctuation">,</span> <span class="token string">'郭'</span><span class="token punctuation">,</span>
        <span class="token string">'梅'</span><span class="token punctuation">,</span> <span class="token string">'盛'</span><span class="token punctuation">,</span> <span class="token string">'林'</span><span class="token punctuation">,</span> <span class="token string">'刁'</span><span class="token punctuation">,</span> <span class="token string">'锺'</span><span class="token punctuation">,</span> <span class="token string">'徐'</span><span class="token punctuation">,</span> <span class="token string">'丘'</span><span class="token punctuation">,</span> <span class="token string">'骆'</span><span class="token punctuation">,</span> <span class="token string">'高'</span><span class="token punctuation">,</span> <span class="token string">'夏'</span><span class="token punctuation">,</span> <span class="token string">'蔡'</span><span class="token punctuation">,</span> <span class="token string">'田'</span><span class="token punctuation">,</span> <span class="token string">'樊'</span><span class="token punctuation">,</span> <span class="token string">'胡'</span><span class="token punctuation">,</span> <span class="token string">'凌'</span><span class="token punctuation">,</span> <span class="token string">'霍'</span><span class="token punctuation">,</span>
        <span class="token string">'虞'</span><span class="token punctuation">,</span> <span class="token string">'万'</span><span class="token punctuation">,</span> <span class="token string">'支'</span><span class="token punctuation">,</span> <span class="token string">'柯'</span><span class="token punctuation">,</span> <span class="token string">'昝'</span><span class="token punctuation">,</span> <span class="token string">'管'</span><span class="token punctuation">,</span> <span class="token string">'卢'</span><span class="token punctuation">,</span> <span class="token string">'莫'</span><span class="token punctuation">,</span> <span class="token string">'经'</span><span class="token punctuation">,</span> <span class="token string">'房'</span><span class="token punctuation">,</span> <span class="token string">'裘'</span><span class="token punctuation">,</span> <span class="token string">'缪'</span><span class="token punctuation">,</span> <span class="token string">'干'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">,</span> <span class="token string">'应'</span><span class="token punctuation">,</span> <span class="token string">'宗'</span><span class="token punctuation">,</span>
        <span class="token string">'丁'</span><span class="token punctuation">,</span> <span class="token string">'宣'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">,</span> <span class="token string">'邓'</span><span class="token punctuation">,</span> <span class="token string">'郁'</span><span class="token punctuation">,</span> <span class="token string">'单'</span><span class="token punctuation">,</span> <span class="token string">'杭'</span><span class="token punctuation">,</span> <span class="token string">'洪'</span><span class="token punctuation">,</span> <span class="token string">'包'</span><span class="token punctuation">,</span> <span class="token string">'诸'</span><span class="token punctuation">,</span> <span class="token string">'左'</span><span class="token punctuation">,</span> <span class="token string">'石'</span><span class="token punctuation">,</span> <span class="token string">'崔'</span><span class="token punctuation">,</span> <span class="token string">'吉'</span><span class="token punctuation">,</span> <span class="token string">'钮'</span><span class="token punctuation">,</span> <span class="token string">'龚'</span><span class="token punctuation">,</span>
        <span class="token string">'程'</span><span class="token punctuation">,</span> <span class="token string">'嵇'</span><span class="token punctuation">,</span> <span class="token string">'邢'</span><span class="token punctuation">,</span> <span class="token string">'滑'</span><span class="token punctuation">,</span> <span class="token string">'裴'</span><span class="token punctuation">,</span> <span class="token string">'陆'</span><span class="token punctuation">,</span> <span class="token string">'荣'</span><span class="token punctuation">,</span> <span class="token string">'翁'</span><span class="token punctuation">,</span> <span class="token string">'荀'</span><span class="token punctuation">,</span> <span class="token string">'羊'</span><span class="token punctuation">,</span> <span class="token string">'於'</span><span class="token punctuation">,</span> <span class="token string">'惠'</span><span class="token punctuation">,</span> <span class="token string">'甄'</span><span class="token punctuation">,</span> <span class="token string">'麹'</span><span class="token punctuation">,</span> <span class="token string">'家'</span><span class="token punctuation">,</span> <span class="token string">'封'</span><span class="token punctuation">,</span>
        <span class="token string">'芮'</span><span class="token punctuation">,</span> <span class="token string">'羿'</span><span class="token punctuation">,</span> <span class="token string">'储'</span><span class="token punctuation">,</span> <span class="token string">'靳'</span><span class="token punctuation">,</span> <span class="token string">'汲'</span><span class="token punctuation">,</span> <span class="token string">'邴'</span><span class="token punctuation">,</span> <span class="token string">'糜'</span><span class="token punctuation">,</span> <span class="token string">'松'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">,</span> <span class="token string">'段'</span><span class="token punctuation">,</span> <span class="token string">'富'</span><span class="token punctuation">,</span> <span class="token string">'巫'</span><span class="token punctuation">,</span> <span class="token string">'乌'</span><span class="token punctuation">,</span> <span class="token string">'焦'</span><span class="token punctuation">,</span> <span class="token string">'巴'</span><span class="token punctuation">,</span> <span class="token string">'弓'</span><span class="token punctuation">,</span>
        <span class="token string">'牧'</span><span class="token punctuation">,</span> <span class="token string">'隗'</span><span class="token punctuation">,</span> <span class="token string">'山'</span><span class="token punctuation">,</span> <span class="token string">'谷'</span><span class="token punctuation">,</span> <span class="token string">'车'</span><span class="token punctuation">,</span> <span class="token string">'侯'</span><span class="token punctuation">,</span> <span class="token string">'宓'</span><span class="token punctuation">,</span> <span class="token string">'蓬'</span><span class="token punctuation">,</span> <span class="token string">'全'</span><span class="token punctuation">,</span> <span class="token string">'郗'</span><span class="token punctuation">,</span> <span class="token string">'班'</span><span class="token punctuation">,</span> <span class="token string">'仰'</span><span class="token punctuation">,</span> <span class="token string">'秋'</span><span class="token punctuation">,</span> <span class="token string">'仲'</span><span class="token punctuation">,</span> <span class="token string">'伊'</span><span class="token punctuation">,</span> <span class="token string">'宫'</span><span class="token punctuation">,</span>
        <span class="token string">'宁'</span><span class="token punctuation">,</span> <span class="token string">'仇'</span><span class="token punctuation">,</span> <span class="token string">'栾'</span><span class="token punctuation">,</span> <span class="token string">'暴'</span><span class="token punctuation">,</span> <span class="token string">'甘'</span><span class="token punctuation">,</span> <span class="token string">'斜'</span><span class="token punctuation">,</span> <span class="token string">'厉'</span><span class="token punctuation">,</span> <span class="token string">'戎'</span><span class="token punctuation">,</span> <span class="token string">'祖'</span><span class="token punctuation">,</span> <span class="token string">'武'</span><span class="token punctuation">,</span> <span class="token string">'符'</span><span class="token punctuation">,</span> <span class="token string">'刘'</span><span class="token punctuation">,</span> <span class="token string">'景'</span><span class="token punctuation">,</span> <span class="token string">'詹'</span><span class="token punctuation">,</span> <span class="token string">'束'</span><span class="token punctuation">,</span> <span class="token string">'龙'</span><span class="token punctuation">,</span>
        <span class="token string">'叶'</span><span class="token punctuation">,</span> <span class="token string">'幸'</span><span class="token punctuation">,</span> <span class="token string">'司'</span><span class="token punctuation">,</span> <span class="token string">'韶'</span><span class="token punctuation">,</span> <span class="token string">'郜'</span><span class="token punctuation">,</span> <span class="token string">'黎'</span><span class="token punctuation">,</span> <span class="token string">'蓟'</span><span class="token punctuation">,</span> <span class="token string">'薄'</span><span class="token punctuation">,</span> <span class="token string">'印'</span><span class="token punctuation">,</span> <span class="token string">'宿'</span><span class="token punctuation">,</span> <span class="token string">'白'</span><span class="token punctuation">,</span> <span class="token string">'怀'</span><span class="token punctuation">,</span> <span class="token string">'蒲'</span><span class="token punctuation">,</span> <span class="token string">'邰'</span><span class="token punctuation">,</span> <span class="token string">'从'</span><span class="token punctuation">,</span> <span class="token string">'鄂'</span><span class="token punctuation">,</span>
        <span class="token string">'索'</span><span class="token punctuation">,</span> <span class="token string">'咸'</span><span class="token punctuation">,</span> <span class="token string">'籍'</span><span class="token punctuation">,</span> <span class="token string">'赖'</span><span class="token punctuation">,</span> <span class="token string">'卓'</span><span class="token punctuation">,</span> <span class="token string">'蔺'</span><span class="token punctuation">,</span> <span class="token string">'屠'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">,</span> <span class="token string">'池'</span><span class="token punctuation">,</span> <span class="token string">'乔'</span><span class="token punctuation">,</span> <span class="token string">'阴'</span><span class="token punctuation">,</span> <span class="token string">'郁'</span><span class="token punctuation">,</span> <span class="token string">'胥'</span><span class="token punctuation">,</span> <span class="token string">'能'</span><span class="token punctuation">,</span> <span class="token string">'苍'</span><span class="token punctuation">,</span> <span class="token string">'双'</span><span class="token punctuation">,</span>
        <span class="token string">'闻'</span><span class="token punctuation">,</span> <span class="token string">'莘'</span><span class="token punctuation">,</span> <span class="token string">'党'</span><span class="token punctuation">,</span> <span class="token string">'翟'</span><span class="token punctuation">,</span> <span class="token string">'谭'</span><span class="token punctuation">,</span> <span class="token string">'贡'</span><span class="token punctuation">,</span> <span class="token string">'劳'</span><span class="token punctuation">,</span> <span class="token string">'逄'</span><span class="token punctuation">,</span> <span class="token string">'姬'</span><span class="token punctuation">,</span> <span class="token string">'申'</span><span class="token punctuation">,</span> <span class="token string">'扶'</span><span class="token punctuation">,</span> <span class="token string">'堵'</span><span class="token punctuation">,</span> <span class="token string">'冉'</span><span class="token punctuation">,</span> <span class="token string">'宰'</span><span class="token punctuation">,</span> <span class="token string">'郦'</span><span class="token punctuation">,</span> <span class="token string">'雍'</span><span class="token punctuation">,</span>
        <span class="token string">'郤'</span><span class="token punctuation">,</span> <span class="token string">'璩'</span><span class="token punctuation">,</span> <span class="token string">'桑'</span><span class="token punctuation">,</span> <span class="token string">'桂'</span><span class="token punctuation">,</span> <span class="token string">'濮'</span><span class="token punctuation">,</span> <span class="token string">'牛'</span><span class="token punctuation">,</span> <span class="token string">'寿'</span><span class="token punctuation">,</span> <span class="token string">'通'</span><span class="token punctuation">,</span> <span class="token string">'边'</span><span class="token punctuation">,</span> <span class="token string">'扈'</span><span class="token punctuation">,</span> <span class="token string">'燕'</span><span class="token punctuation">,</span> <span class="token string">'冀'</span><span class="token punctuation">,</span> <span class="token string">'郏'</span><span class="token punctuation">,</span> <span class="token string">'浦'</span><span class="token punctuation">,</span> <span class="token string">'尚'</span><span class="token punctuation">,</span> <span class="token string">'农'</span><span class="token punctuation">,</span>
        <span class="token string">'温'</span><span class="token punctuation">,</span> <span class="token string">'别'</span><span class="token punctuation">,</span> <span class="token string">'庄'</span><span class="token punctuation">,</span> <span class="token string">'晏'</span><span class="token punctuation">,</span> <span class="token string">'柴'</span><span class="token punctuation">,</span> <span class="token string">'瞿'</span><span class="token punctuation">,</span> <span class="token string">'阎'</span><span class="token punctuation">,</span> <span class="token string">'充'</span><span class="token punctuation">,</span> <span class="token string">'慕'</span><span class="token punctuation">,</span> <span class="token string">'连'</span><span class="token punctuation">,</span> <span class="token string">'茹'</span><span class="token punctuation">,</span> <span class="token string">'习'</span><span class="token punctuation">,</span> <span class="token string">'宦'</span><span class="token punctuation">,</span> <span class="token string">'艾'</span><span class="token punctuation">,</span> <span class="token string">'鱼'</span><span class="token punctuation">,</span> <span class="token string">'容'</span><span class="token punctuation">,</span>
        <span class="token string">'向'</span><span class="token punctuation">,</span> <span class="token string">'古'</span><span class="token punctuation">,</span> <span class="token string">'易'</span><span class="token punctuation">,</span> <span class="token string">'慎'</span><span class="token punctuation">,</span> <span class="token string">'戈'</span><span class="token punctuation">,</span> <span class="token string">'廖'</span><span class="token punctuation">,</span> <span class="token string">'庾'</span><span class="token punctuation">,</span> <span class="token string">'终'</span><span class="token punctuation">,</span> <span class="token string">'暨'</span><span class="token punctuation">,</span> <span class="token string">'居'</span><span class="token punctuation">,</span> <span class="token string">'衡'</span><span class="token punctuation">,</span> <span class="token string">'步'</span><span class="token punctuation">,</span> <span class="token string">'都'</span><span class="token punctuation">,</span> <span class="token string">'耿'</span><span class="token punctuation">,</span> <span class="token string">'满'</span><span class="token punctuation">,</span> <span class="token string">'弘'</span><span class="token punctuation">,</span>
        <span class="token string">'匡'</span><span class="token punctuation">,</span> <span class="token string">'国'</span><span class="token punctuation">,</span> <span class="token string">'文'</span><span class="token punctuation">,</span> <span class="token string">'寇'</span><span class="token punctuation">,</span> <span class="token string">'广'</span><span class="token punctuation">,</span> <span class="token string">'禄'</span><span class="token punctuation">,</span> <span class="token string">'阙'</span><span class="token punctuation">,</span> <span class="token string">'东'</span><span class="token punctuation">,</span> <span class="token string">'欧'</span><span class="token punctuation">,</span> <span class="token string">'殳'</span><span class="token punctuation">,</span> <span class="token string">'沃'</span><span class="token punctuation">,</span> <span class="token string">'利'</span><span class="token punctuation">,</span> <span class="token string">'蔚'</span><span class="token punctuation">,</span> <span class="token string">'越'</span><span class="token punctuation">,</span> <span class="token string">'夔'</span><span class="token punctuation">,</span> <span class="token string">'隆'</span><span class="token punctuation">,</span>
        <span class="token string">'师'</span><span class="token punctuation">,</span> <span class="token string">'巩'</span><span class="token punctuation">,</span> <span class="token string">'厍'</span><span class="token punctuation">,</span> <span class="token string">'聂'</span><span class="token punctuation">,</span> <span class="token string">'晁'</span><span class="token punctuation">,</span> <span class="token string">'勾'</span><span class="token punctuation">,</span> <span class="token string">'敖'</span><span class="token punctuation">,</span> <span class="token string">'融'</span><span class="token punctuation">,</span> <span class="token string">'冷'</span><span class="token punctuation">,</span> <span class="token string">'訾'</span><span class="token punctuation">,</span> <span class="token string">'辛'</span><span class="token punctuation">,</span> <span class="token string">'阚'</span><span class="token punctuation">,</span> <span class="token string">'那'</span><span class="token punctuation">,</span> <span class="token string">'简'</span><span class="token punctuation">,</span> <span class="token string">'饶'</span><span class="token punctuation">,</span> <span class="token string">'空'</span><span class="token punctuation">,</span>
        <span class="token string">'曾'</span><span class="token punctuation">,</span> <span class="token string">'毋'</span><span class="token punctuation">,</span> <span class="token string">'沙'</span><span class="token punctuation">,</span> <span class="token string">'乜'</span><span class="token punctuation">,</span> <span class="token string">'养'</span><span class="token punctuation">,</span> <span class="token string">'鞠'</span><span class="token punctuation">,</span> <span class="token string">'须'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">,</span> <span class="token string">'巢'</span><span class="token punctuation">,</span> <span class="token string">'关'</span><span class="token punctuation">,</span> <span class="token string">'蒯'</span><span class="token punctuation">,</span> <span class="token string">'相'</span><span class="token punctuation">,</span> <span class="token string">'查'</span><span class="token punctuation">,</span> <span class="token string">'后'</span><span class="token punctuation">,</span> <span class="token string">'荆'</span><span class="token punctuation">,</span> <span class="token string">'红'</span><span class="token punctuation">,</span>
        <span class="token string">'游'</span><span class="token punctuation">,</span> <span class="token string">'竺'</span><span class="token punctuation">,</span> <span class="token string">'权'</span><span class="token punctuation">,</span> <span class="token string">'逑'</span><span class="token punctuation">,</span> <span class="token string">'盖'</span><span class="token punctuation">,</span> <span class="token string">'益'</span><span class="token punctuation">,</span> <span class="token string">'桓'</span><span class="token punctuation">,</span> <span class="token string">'公'</span><span class="token punctuation">,</span> <span class="token string">'仉'</span><span class="token punctuation">,</span> <span class="token string">'督'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">,</span> <span class="token string">'楚'</span><span class="token punctuation">,</span> <span class="token string">'阎'</span><span class="token punctuation">,</span> <span class="token string">'法'</span><span class="token punctuation">,</span> <span class="token string">'汝'</span><span class="token punctuation">,</span> <span class="token string">'鄢'</span><span class="token punctuation">,</span>
        <span class="token string">'涂'</span><span class="token punctuation">,</span> <span class="token string">'钦'</span><span class="token punctuation">,</span> <span class="token string">'岳'</span><span class="token punctuation">,</span> <span class="token string">'帅'</span><span class="token punctuation">,</span> <span class="token string">'缑'</span><span class="token punctuation">,</span> <span class="token string">'亢'</span><span class="token punctuation">,</span> <span class="token string">'况'</span><span class="token punctuation">,</span> <span class="token string">'后'</span><span class="token punctuation">,</span> <span class="token string">'有'</span><span class="token punctuation">,</span> <span class="token string">'琴'</span><span class="token punctuation">,</span> <span class="token string">'归'</span><span class="token punctuation">,</span> <span class="token string">'海'</span><span class="token punctuation">,</span> <span class="token string">'墨'</span><span class="token punctuation">,</span> <span class="token string">'哈'</span><span class="token punctuation">,</span> <span class="token string">'谯'</span><span class="token punctuation">,</span> <span class="token string">'笪'</span><span class="token punctuation">,</span>
        <span class="token string">'年'</span><span class="token punctuation">,</span> <span class="token string">'爱'</span><span class="token punctuation">,</span> <span class="token string">'阳'</span><span class="token punctuation">,</span> <span class="token string">'佟'</span><span class="token punctuation">,</span> <span class="token string">'商'</span><span class="token punctuation">,</span> <span class="token string">'牟'</span><span class="token punctuation">,</span> <span class="token string">'佘'</span><span class="token punctuation">,</span> <span class="token string">'佴'</span><span class="token punctuation">,</span> <span class="token string">'伯'</span><span class="token punctuation">,</span> <span class="token string">'赏'</span><span class="token punctuation">,</span> <span class="token string">'万俟'</span><span class="token punctuation">,</span> <span class="token string">'司马'</span><span class="token punctuation">,</span> <span class="token string">'上官'</span><span class="token punctuation">,</span> <span class="token string">'欧阳'</span><span class="token punctuation">,</span> <span class="token string">'夏侯'</span><span class="token punctuation">,</span>
        <span class="token string">'诸葛'</span><span class="token punctuation">,</span> <span class="token string">'闻人'</span><span class="token punctuation">,</span> <span class="token string">'东方'</span><span class="token punctuation">,</span> <span class="token string">'赫连'</span><span class="token punctuation">,</span> <span class="token string">'皇甫'</span><span class="token punctuation">,</span> <span class="token string">'尉迟'</span><span class="token punctuation">,</span> <span class="token string">'公羊'</span><span class="token punctuation">,</span> <span class="token string">'澹台'</span><span class="token punctuation">,</span> <span class="token string">'公冶'</span><span class="token punctuation">,</span> <span class="token string">'宗政'</span><span class="token punctuation">,</span> <span class="token string">'濮阳'</span><span class="token punctuation">,</span> <span class="token string">'淳于'</span><span class="token punctuation">,</span>
        <span class="token string">'单于'</span><span class="token punctuation">,</span> <span class="token string">'太叔'</span><span class="token punctuation">,</span> <span class="token string">'申屠'</span><span class="token punctuation">,</span> <span class="token string">'公孙'</span><span class="token punctuation">,</span> <span class="token string">'仲孙'</span><span class="token punctuation">,</span> <span class="token string">'轩辕'</span><span class="token punctuation">,</span> <span class="token string">'令狐'</span><span class="token punctuation">,</span> <span class="token string">'锺离'</span><span class="token punctuation">,</span> <span class="token string">'宇文'</span><span class="token punctuation">,</span> <span class="token string">'长孙'</span><span class="token punctuation">,</span> <span class="token string">'慕容'</span><span class="token punctuation">,</span> <span class="token string">'鲜于'</span><span class="token punctuation">,</span>
        <span class="token string">'闾丘'</span><span class="token punctuation">,</span> <span class="token string">'司徒'</span><span class="token punctuation">,</span> <span class="token string">'司空'</span><span class="token punctuation">,</span> <span class="token string">'丌官'</span><span class="token punctuation">,</span> <span class="token string">'司寇'</span><span class="token punctuation">,</span> <span class="token string">'子车'</span><span class="token punctuation">,</span> <span class="token string">'微生'</span><span class="token punctuation">,</span> <span class="token string">'颛孙'</span><span class="token punctuation">,</span> <span class="token string">'端木'</span><span class="token punctuation">,</span> <span class="token string">'巫马'</span><span class="token punctuation">,</span> <span class="token string">'公西'</span><span class="token punctuation">,</span> <span class="token string">'漆雕'</span><span class="token punctuation">,</span>
        <span class="token string">'乐正'</span><span class="token punctuation">,</span> <span class="token string">'壤驷'</span><span class="token punctuation">,</span> <span class="token string">'公良'</span><span class="token punctuation">,</span> <span class="token string">'拓拔'</span><span class="token punctuation">,</span> <span class="token string">'夹谷'</span><span class="token punctuation">,</span> <span class="token string">'宰父'</span><span class="token punctuation">,</span> <span class="token string">'谷梁'</span><span class="token punctuation">,</span> <span class="token string">'段干'</span><span class="token punctuation">,</span> <span class="token string">'百里'</span><span class="token punctuation">,</span> <span class="token string">'东郭'</span><span class="token punctuation">,</span> <span class="token string">'南门'</span><span class="token punctuation">,</span> <span class="token string">'呼延'</span><span class="token punctuation">,</span>
        <span class="token string">'羊舌'</span><span class="token punctuation">,</span> <span class="token string">'梁丘'</span><span class="token punctuation">,</span> <span class="token string">'左丘'</span><span class="token punctuation">,</span> <span class="token string">'东门'</span><span class="token punctuation">,</span> <span class="token string">'西门'</span><span class="token punctuation">,</span> <span class="token string">'南宫'</span>
      <span class="token punctuation">]</span>

      <span class="token keyword">var</span> lastNames <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'子璇'</span><span class="token punctuation">,</span> <span class="token string">'淼'</span><span class="token punctuation">,</span> <span class="token string">'国栋'</span><span class="token punctuation">,</span> <span class="token string">'夫子'</span><span class="token punctuation">,</span> <span class="token string">'瑞堂'</span><span class="token punctuation">,</span> <span class="token string">'甜'</span><span class="token punctuation">,</span> <span class="token string">'敏'</span><span class="token punctuation">,</span> <span class="token string">'尚'</span><span class="token punctuation">,</span> <span class="token string">'国贤'</span><span class="token punctuation">,</span> <span class="token string">'贺祥'</span><span class="token punctuation">,</span> <span class="token string">'晨涛'</span><span class="token punctuation">,</span>
        <span class="token string">'昊轩'</span><span class="token punctuation">,</span> <span class="token string">'易轩'</span><span class="token punctuation">,</span> <span class="token string">'益辰'</span><span class="token punctuation">,</span> <span class="token string">'益帆'</span><span class="token punctuation">,</span> <span class="token string">'益冉'</span><span class="token punctuation">,</span> <span class="token string">'瑾春'</span><span class="token punctuation">,</span> <span class="token string">'瑾昆'</span><span class="token punctuation">,</span> <span class="token string">'春齐'</span><span class="token punctuation">,</span> <span class="token string">'杨'</span><span class="token punctuation">,</span> <span class="token string">'文昊'</span><span class="token punctuation">,</span>
        <span class="token string">'东东'</span><span class="token punctuation">,</span> <span class="token string">'雄霖'</span><span class="token punctuation">,</span> <span class="token string">'浩晨'</span><span class="token punctuation">,</span> <span class="token string">'熙涵'</span><span class="token punctuation">,</span> <span class="token string">'溶溶'</span><span class="token punctuation">,</span> <span class="token string">'冰枫'</span><span class="token punctuation">,</span> <span class="token string">'欣欣'</span><span class="token punctuation">,</span> <span class="token string">'宜豪'</span><span class="token punctuation">,</span> <span class="token string">'欣慧'</span><span class="token punctuation">,</span> <span class="token string">'建政'</span><span class="token punctuation">,</span>
        <span class="token string">'美欣'</span><span class="token punctuation">,</span> <span class="token string">'淑慧'</span><span class="token punctuation">,</span> <span class="token string">'文轩'</span><span class="token punctuation">,</span> <span class="token string">'文杰'</span><span class="token punctuation">,</span> <span class="token string">'欣源'</span><span class="token punctuation">,</span> <span class="token string">'忠林'</span><span class="token punctuation">,</span> <span class="token string">'榕润'</span><span class="token punctuation">,</span> <span class="token string">'欣汝'</span><span class="token punctuation">,</span> <span class="token string">'慧嘉'</span><span class="token punctuation">,</span> <span class="token string">'新建'</span><span class="token punctuation">,</span>
        <span class="token string">'建林'</span><span class="token punctuation">,</span> <span class="token string">'亦菲'</span><span class="token punctuation">,</span> <span class="token string">'林'</span><span class="token punctuation">,</span> <span class="token string">'冰洁'</span><span class="token punctuation">,</span> <span class="token string">'佳欣'</span><span class="token punctuation">,</span> <span class="token string">'涵涵'</span><span class="token punctuation">,</span> <span class="token string">'禹辰'</span><span class="token punctuation">,</span> <span class="token string">'淳美'</span><span class="token punctuation">,</span> <span class="token string">'泽惠'</span><span class="token punctuation">,</span> <span class="token string">'伟洋'</span><span class="token punctuation">,</span>
        <span class="token string">'涵越'</span><span class="token punctuation">,</span> <span class="token string">'润丽'</span><span class="token punctuation">,</span> <span class="token string">'翔'</span><span class="token punctuation">,</span> <span class="token string">'淑华'</span><span class="token punctuation">,</span> <span class="token string">'晶莹'</span><span class="token punctuation">,</span> <span class="token string">'凌晶'</span><span class="token punctuation">,</span> <span class="token string">'苒溪'</span><span class="token punctuation">,</span> <span class="token string">'雨涵'</span><span class="token punctuation">,</span> <span class="token string">'嘉怡'</span><span class="token punctuation">,</span> <span class="token string">'佳毅'</span><span class="token punctuation">,</span>
        <span class="token string">'子辰'</span><span class="token punctuation">,</span> <span class="token string">'佳琪'</span><span class="token punctuation">,</span> <span class="token string">'紫轩'</span><span class="token punctuation">,</span> <span class="token string">'瑞辰'</span><span class="token punctuation">,</span> <span class="token string">'昕蕊'</span><span class="token punctuation">,</span> <span class="token string">'萌'</span><span class="token punctuation">,</span> <span class="token string">'明远'</span><span class="token punctuation">,</span> <span class="token string">'欣宜'</span><span class="token punctuation">,</span> <span class="token string">'泽远'</span><span class="token punctuation">,</span> <span class="token string">'欣怡'</span><span class="token punctuation">,</span>
        <span class="token string">'佳怡'</span><span class="token punctuation">,</span> <span class="token string">'佳惠'</span><span class="token punctuation">,</span> <span class="token string">'晨茜'</span><span class="token punctuation">,</span> <span class="token string">'晨璐'</span><span class="token punctuation">,</span> <span class="token string">'运昊'</span><span class="token punctuation">,</span> <span class="token string">'汝鑫'</span><span class="token punctuation">,</span> <span class="token string">'淑君'</span><span class="token punctuation">,</span> <span class="token string">'晶滢'</span><span class="token punctuation">,</span> <span class="token string">'润莎'</span><span class="token punctuation">,</span> <span class="token string">'榕汕'</span><span class="token punctuation">,</span>
        <span class="token string">'佳钰'</span><span class="token punctuation">,</span> <span class="token string">'佳玉'</span><span class="token punctuation">,</span> <span class="token string">'晓庆'</span><span class="token punctuation">,</span> <span class="token string">'一鸣'</span><span class="token punctuation">,</span> <span class="token string">'语晨'</span><span class="token punctuation">,</span> <span class="token string">'添池'</span><span class="token punctuation">,</span> <span class="token string">'添昊'</span><span class="token punctuation">,</span> <span class="token string">'雨泽'</span><span class="token punctuation">,</span> <span class="token string">'雅晗'</span><span class="token punctuation">,</span> <span class="token string">'雅涵'</span><span class="token punctuation">,</span>
        <span class="token string">'清妍'</span><span class="token punctuation">,</span> <span class="token string">'诗悦'</span><span class="token punctuation">,</span> <span class="token string">'嘉乐'</span><span class="token punctuation">,</span> <span class="token string">'晨涵'</span><span class="token punctuation">,</span> <span class="token string">'天赫'</span><span class="token punctuation">,</span> <span class="token string">'玥傲'</span><span class="token punctuation">,</span> <span class="token string">'佳昊'</span><span class="token punctuation">,</span> <span class="token string">'天昊'</span><span class="token punctuation">,</span> <span class="token string">'萌萌'</span><span class="token punctuation">,</span> <span class="token string">'若萌'</span><span class="token punctuation">,</span>
        <span class="token string">'秋白'</span><span class="token punctuation">,</span> <span class="token string">'南风'</span><span class="token punctuation">,</span> <span class="token string">'醉山'</span><span class="token punctuation">,</span> <span class="token string">'初彤'</span><span class="token punctuation">,</span> <span class="token string">'凝海'</span><span class="token punctuation">,</span> <span class="token string">'紫文'</span><span class="token punctuation">,</span> <span class="token string">'凌晴'</span><span class="token punctuation">,</span> <span class="token string">'香卉'</span><span class="token punctuation">,</span> <span class="token string">'雅琴'</span><span class="token punctuation">,</span> <span class="token string">'傲安'</span><span class="token punctuation">,</span>
        <span class="token string">'傲之'</span><span class="token punctuation">,</span> <span class="token string">'初蝶'</span><span class="token punctuation">,</span> <span class="token string">'寻桃'</span><span class="token punctuation">,</span> <span class="token string">'代芹'</span><span class="token punctuation">,</span> <span class="token string">'诗霜'</span><span class="token punctuation">,</span> <span class="token string">'春柏'</span><span class="token punctuation">,</span> <span class="token string">'绿夏'</span><span class="token punctuation">,</span> <span class="token string">'碧灵'</span><span class="token punctuation">,</span> <span class="token string">'诗柳'</span><span class="token punctuation">,</span> <span class="token string">'夏柳'</span><span class="token punctuation">,</span>
        <span class="token string">'采白'</span><span class="token punctuation">,</span> <span class="token string">'慕梅'</span><span class="token punctuation">,</span> <span class="token string">'乐安'</span><span class="token punctuation">,</span> <span class="token string">'冬菱'</span><span class="token punctuation">,</span> <span class="token string">'紫安'</span><span class="token punctuation">,</span> <span class="token string">'宛凝'</span><span class="token punctuation">,</span> <span class="token string">'雨雪'</span><span class="token punctuation">,</span> <span class="token string">'易真'</span><span class="token punctuation">,</span> <span class="token string">'安荷'</span><span class="token punctuation">,</span> <span class="token string">'静竹'</span><span class="token punctuation">,</span>
        <span class="token string">'飞雪'</span><span class="token punctuation">,</span> <span class="token string">'雪兰'</span><span class="token punctuation">,</span> <span class="token string">'雅霜'</span><span class="token punctuation">,</span> <span class="token string">'从蓉'</span><span class="token punctuation">,</span> <span class="token string">'冷雪'</span><span class="token punctuation">,</span> <span class="token string">'靖巧'</span><span class="token punctuation">,</span> <span class="token string">'翠丝'</span><span class="token punctuation">,</span> <span class="token string">'觅翠'</span><span class="token punctuation">,</span> <span class="token string">'凡白'</span><span class="token punctuation">,</span> <span class="token string">'乐蓉'</span><span class="token punctuation">,</span>
        <span class="token string">'迎波'</span><span class="token punctuation">,</span> <span class="token string">'丹烟'</span><span class="token punctuation">,</span> <span class="token string">'梦旋'</span><span class="token punctuation">,</span> <span class="token string">'书双'</span><span class="token punctuation">,</span> <span class="token string">'念桃'</span><span class="token punctuation">,</span> <span class="token string">'夜天'</span><span class="token punctuation">,</span> <span class="token string">'海桃'</span><span class="token punctuation">,</span> <span class="token string">'青香'</span><span class="token punctuation">,</span> <span class="token string">'恨风'</span><span class="token punctuation">,</span> <span class="token string">'安筠'</span><span class="token punctuation">,</span>
        <span class="token string">'觅柔'</span><span class="token punctuation">,</span> <span class="token string">'初南'</span><span class="token punctuation">,</span> <span class="token string">'秋蝶'</span><span class="token punctuation">,</span> <span class="token string">'千易'</span><span class="token punctuation">,</span> <span class="token string">'安露'</span><span class="token punctuation">,</span> <span class="token string">'诗蕊'</span><span class="token punctuation">,</span> <span class="token string">'山雁'</span><span class="token punctuation">,</span> <span class="token string">'友菱'</span><span class="token punctuation">,</span> <span class="token string">'香露'</span><span class="token punctuation">,</span> <span class="token string">'晓兰'</span><span class="token punctuation">,</span>
        <span class="token string">'涵瑶'</span><span class="token punctuation">,</span> <span class="token string">'秋柔'</span><span class="token punctuation">,</span> <span class="token string">'思菱'</span><span class="token punctuation">,</span> <span class="token string">'醉柳'</span><span class="token punctuation">,</span> <span class="token string">'以寒'</span><span class="token punctuation">,</span> <span class="token string">'迎夏'</span><span class="token punctuation">,</span> <span class="token string">'向雪'</span><span class="token punctuation">,</span> <span class="token string">'香莲'</span><span class="token punctuation">,</span> <span class="token string">'以丹'</span><span class="token punctuation">,</span> <span class="token string">'依凝'</span><span class="token punctuation">,</span>
        <span class="token string">'如柏'</span><span class="token punctuation">,</span> <span class="token string">'雁菱'</span><span class="token punctuation">,</span> <span class="token string">'凝竹'</span><span class="token punctuation">,</span> <span class="token string">'宛白'</span><span class="token punctuation">,</span> <span class="token string">'初柔'</span><span class="token punctuation">,</span> <span class="token string">'南蕾'</span><span class="token punctuation">,</span> <span class="token string">'书萱'</span><span class="token punctuation">,</span> <span class="token string">'梦槐'</span><span class="token punctuation">,</span> <span class="token string">'香芹'</span><span class="token punctuation">,</span> <span class="token string">'南琴'</span><span class="token punctuation">,</span>
        <span class="token string">'绿海'</span><span class="token punctuation">,</span> <span class="token string">'沛儿'</span><span class="token punctuation">,</span> <span class="token string">'晓瑶'</span><span class="token punctuation">,</span> <span class="token string">'听春'</span><span class="token punctuation">,</span> <span class="token string">'易巧'</span><span class="token punctuation">,</span> <span class="token string">'念云'</span><span class="token punctuation">,</span> <span class="token string">'晓灵'</span><span class="token punctuation">,</span> <span class="token string">'静枫'</span><span class="token punctuation">,</span> <span class="token string">'夏蓉'</span><span class="token punctuation">,</span> <span class="token string">'如南'</span><span class="token punctuation">,</span>
        <span class="token string">'幼丝'</span><span class="token punctuation">,</span> <span class="token string">'秋白'</span><span class="token punctuation">,</span> <span class="token string">'冰安'</span><span class="token punctuation">,</span> <span class="token string">'凝蝶'</span><span class="token punctuation">,</span> <span class="token string">'紫雪'</span><span class="token punctuation">,</span> <span class="token string">'念双'</span><span class="token punctuation">,</span> <span class="token string">'念真'</span><span class="token punctuation">,</span> <span class="token string">'曼寒'</span><span class="token punctuation">,</span> <span class="token string">'凡霜'</span><span class="token punctuation">,</span> <span class="token string">'白卉'</span><span class="token punctuation">,</span>
        <span class="token string">'语山'</span><span class="token punctuation">,</span> <span class="token string">'冷珍'</span><span class="token punctuation">,</span> <span class="token string">'秋翠'</span><span class="token punctuation">,</span> <span class="token string">'夏柳'</span><span class="token punctuation">,</span> <span class="token string">'如之'</span><span class="token punctuation">,</span> <span class="token string">'忆南'</span><span class="token punctuation">,</span> <span class="token string">'书易'</span><span class="token punctuation">,</span> <span class="token string">'翠桃'</span><span class="token punctuation">,</span> <span class="token string">'寄瑶'</span><span class="token punctuation">,</span> <span class="token string">'如曼'</span><span class="token punctuation">,</span>
        <span class="token string">'问柳'</span><span class="token punctuation">,</span> <span class="token string">'香梅'</span><span class="token punctuation">,</span> <span class="token string">'幻桃'</span><span class="token punctuation">,</span> <span class="token string">'又菡'</span><span class="token punctuation">,</span> <span class="token string">'春绿'</span><span class="token punctuation">,</span> <span class="token string">'醉蝶'</span><span class="token punctuation">,</span> <span class="token string">'亦绿'</span><span class="token punctuation">,</span> <span class="token string">'诗珊'</span><span class="token punctuation">,</span> <span class="token string">'听芹'</span><span class="token punctuation">,</span> <span class="token string">'新之'</span><span class="token punctuation">,</span>
        <span class="token string">'博瀚'</span><span class="token punctuation">,</span> <span class="token string">'博超'</span><span class="token punctuation">,</span> <span class="token string">'才哲'</span><span class="token punctuation">,</span> <span class="token string">'才俊'</span><span class="token punctuation">,</span> <span class="token string">'成和'</span><span class="token punctuation">,</span> <span class="token string">'成弘'</span><span class="token punctuation">,</span> <span class="token string">'昊苍'</span><span class="token punctuation">,</span> <span class="token string">'昊昊'</span><span class="token punctuation">,</span> <span class="token string">'昊空'</span><span class="token punctuation">,</span> <span class="token string">'昊乾'</span><span class="token punctuation">,</span>
        <span class="token string">'昊然'</span><span class="token punctuation">,</span> <span class="token string">'昊然'</span><span class="token punctuation">,</span> <span class="token string">'昊天'</span><span class="token punctuation">,</span> <span class="token string">'昊焱'</span><span class="token punctuation">,</span> <span class="token string">'昊英'</span><span class="token punctuation">,</span> <span class="token string">'浩波'</span><span class="token punctuation">,</span> <span class="token string">'浩博'</span><span class="token punctuation">,</span> <span class="token string">'浩初'</span><span class="token punctuation">,</span> <span class="token string">'浩大'</span><span class="token punctuation">,</span> <span class="token string">'浩宕'</span><span class="token punctuation">,</span>
        <span class="token string">'浩荡'</span><span class="token punctuation">,</span> <span class="token string">'浩歌'</span><span class="token punctuation">,</span> <span class="token string">'浩广'</span><span class="token punctuation">,</span> <span class="token string">'浩涆'</span><span class="token punctuation">,</span> <span class="token string">'浩瀚'</span><span class="token punctuation">,</span> <span class="token string">'浩浩'</span><span class="token punctuation">,</span> <span class="token string">'浩慨'</span><span class="token punctuation">,</span> <span class="token string">'浩旷'</span><span class="token punctuation">,</span> <span class="token string">'浩阔'</span><span class="token punctuation">,</span> <span class="token string">'浩漫'</span><span class="token punctuation">,</span>
        <span class="token string">'浩淼'</span><span class="token punctuation">,</span> <span class="token string">'浩渺'</span><span class="token punctuation">,</span> <span class="token string">'浩邈'</span><span class="token punctuation">,</span> <span class="token string">'浩气'</span><span class="token punctuation">,</span> <span class="token string">'浩然'</span><span class="token punctuation">,</span> <span class="token string">'浩穰'</span><span class="token punctuation">,</span> <span class="token string">'浩壤'</span><span class="token punctuation">,</span> <span class="token string">'浩思'</span><span class="token punctuation">,</span> <span class="token string">'浩言'</span><span class="token punctuation">,</span> <span class="token string">'皓轩'</span><span class="token punctuation">,</span>
        <span class="token string">'和蔼'</span><span class="token punctuation">,</span> <span class="token string">'和安'</span><span class="token punctuation">,</span> <span class="token string">'和昶'</span><span class="token punctuation">,</span> <span class="token string">'翔东'</span><span class="token punctuation">,</span> <span class="token string">'昊伟'</span><span class="token punctuation">,</span> <span class="token string">'楚桥'</span><span class="token punctuation">,</span> <span class="token string">'智霖'</span><span class="token punctuation">,</span> <span class="token string">'浩杰'</span><span class="token punctuation">,</span> <span class="token string">'炎承'</span><span class="token punctuation">,</span> <span class="token string">'思哲'</span><span class="token punctuation">,</span>
        <span class="token string">'璟新'</span><span class="token punctuation">,</span> <span class="token string">'楚怀'</span><span class="token punctuation">,</span> <span class="token string">'继智'</span><span class="token punctuation">,</span> <span class="token string">'昭旺'</span><span class="token punctuation">,</span> <span class="token string">'俊泽'</span><span class="token punctuation">,</span> <span class="token string">'子中'</span><span class="token punctuation">,</span> <span class="token string">'羽睿'</span><span class="token punctuation">,</span> <span class="token string">'嘉雷'</span><span class="token punctuation">,</span> <span class="token string">'鸿翔'</span><span class="token punctuation">,</span> <span class="token string">'明轩'</span><span class="token punctuation">,</span>
        <span class="token string">'棋齐'</span><span class="token punctuation">,</span> <span class="token string">'轶乐'</span><span class="token punctuation">,</span> <span class="token string">'昭易'</span><span class="token punctuation">,</span> <span class="token string">'臻翔'</span><span class="token punctuation">,</span> <span class="token string">'泽鑫'</span><span class="token punctuation">,</span> <span class="token string">'芮军'</span><span class="token punctuation">,</span> <span class="token string">'浩奕'</span><span class="token punctuation">,</span> <span class="token string">'宏明'</span><span class="token punctuation">,</span> <span class="token string">'忠贤'</span><span class="token punctuation">,</span> <span class="token string">'锦辉'</span><span class="token punctuation">,</span>
        <span class="token string">'元毅'</span><span class="token punctuation">,</span> <span class="token string">'霈胜'</span><span class="token punctuation">,</span> <span class="token string">'宇峻'</span><span class="token punctuation">,</span> <span class="token string">'子博'</span><span class="token punctuation">,</span> <span class="token string">'语霖'</span><span class="token punctuation">,</span> <span class="token string">'胜佑'</span><span class="token punctuation">,</span> <span class="token string">'俊涛'</span><span class="token punctuation">,</span> <span class="token string">'浩淇'</span><span class="token punctuation">,</span> <span class="token string">'乐航'</span><span class="token punctuation">,</span> <span class="token string">'泽楷'</span><span class="token punctuation">,</span>
        <span class="token string">'嘉宁'</span><span class="token punctuation">,</span> <span class="token string">'敬宣'</span><span class="token punctuation">,</span> <span class="token string">'韦宁'</span><span class="token punctuation">,</span> <span class="token string">'建新'</span><span class="token punctuation">,</span> <span class="token string">'宇怀'</span><span class="token punctuation">,</span> <span class="token string">'皓玄'</span><span class="token punctuation">,</span> <span class="token string">'冠捷'</span><span class="token punctuation">,</span> <span class="token string">'俊铭'</span><span class="token punctuation">,</span> <span class="token string">'一鸣'</span><span class="token punctuation">,</span> <span class="token string">'堂耀'</span><span class="token punctuation">,</span>
        <span class="token string">'轩凝'</span><span class="token punctuation">,</span> <span class="token string">'舰曦'</span><span class="token punctuation">,</span> <span class="token string">'跃鑫'</span><span class="token punctuation">,</span> <span class="token string">'梓杰'</span><span class="token punctuation">,</span> <span class="token string">'筱宇'</span><span class="token punctuation">,</span> <span class="token string">'弘涛'</span><span class="token punctuation">,</span> <span class="token string">'羿天'</span><span class="token punctuation">,</span> <span class="token string">'广嘉'</span><span class="token punctuation">,</span> <span class="token string">'陆铭'</span><span class="token punctuation">,</span> <span class="token string">'志卿'</span><span class="token punctuation">,</span>
        <span class="token string">'连彬'</span><span class="token punctuation">,</span> <span class="token string">'景智'</span><span class="token punctuation">,</span> <span class="token string">'孟昕'</span><span class="token punctuation">,</span> <span class="token string">'羿然'</span><span class="token punctuation">,</span> <span class="token string">'文渊'</span><span class="token punctuation">,</span> <span class="token string">'羿楦'</span><span class="token punctuation">,</span> <span class="token string">'晗昱'</span><span class="token punctuation">,</span> <span class="token string">'晗日'</span><span class="token punctuation">,</span> <span class="token string">'涵畅'</span><span class="token punctuation">,</span> <span class="token string">'涵涤'</span><span class="token punctuation">,</span>
        <span class="token string">'昊穹'</span><span class="token punctuation">,</span> <span class="token string">'涵亮'</span><span class="token punctuation">,</span> <span class="token string">'涵忍'</span><span class="token punctuation">,</span> <span class="token string">'涵容'</span><span class="token punctuation">,</span> <span class="token string">'俊可'</span><span class="token punctuation">,</span> <span class="token string">'智鹏'</span><span class="token punctuation">,</span> <span class="token string">'诚钰'</span><span class="token punctuation">,</span> <span class="token string">'书墨'</span><span class="token punctuation">,</span> <span class="token string">'俊易'</span><span class="token punctuation">,</span> <span class="token string">'浩渺'</span><span class="token punctuation">,</span>
        <span class="token string">'宸水'</span><span class="token punctuation">,</span> <span class="token string">'嘉许'</span><span class="token punctuation">,</span> <span class="token string">'时贤'</span><span class="token punctuation">,</span> <span class="token string">'飞腾'</span><span class="token punctuation">,</span> <span class="token string">'沂晨'</span><span class="token punctuation">,</span> <span class="token string">'殿斌'</span><span class="token punctuation">,</span> <span class="token string">'霄鸿'</span><span class="token punctuation">,</span> <span class="token string">'辰略'</span><span class="token punctuation">,</span> <span class="token string">'澜鸿'</span><span class="token punctuation">,</span> <span class="token string">'景博'</span><span class="token punctuation">,</span>
        <span class="token string">'咨涵'</span><span class="token punctuation">,</span> <span class="token string">'修德'</span><span class="token punctuation">,</span> <span class="token string">'景辉'</span><span class="token punctuation">,</span> <span class="token string">'语旋'</span><span class="token punctuation">,</span> <span class="token string">'智逸'</span><span class="token punctuation">,</span> <span class="token string">'鸿锋'</span><span class="token punctuation">,</span> <span class="token string">'思梵'</span><span class="token punctuation">,</span> <span class="token string">'弈煊'</span><span class="token punctuation">,</span> <span class="token string">'泰河'</span><span class="token punctuation">,</span> <span class="token string">'逞宇'</span><span class="token punctuation">,</span>
        <span class="token string">'嘉颢'</span><span class="token punctuation">,</span> <span class="token string">'锦沅'</span><span class="token punctuation">,</span> <span class="token string">'颢焱'</span><span class="token punctuation">,</span> <span class="token string">'萧彬'</span><span class="token punctuation">,</span> <span class="token string">'悦升'</span><span class="token punctuation">,</span> <span class="token string">'香音'</span><span class="token punctuation">,</span> <span class="token string">'烨柠'</span><span class="token punctuation">,</span> <span class="token string">'颢咏'</span><span class="token punctuation">,</span> <span class="token string">'仁贤'</span><span class="token punctuation">,</span> <span class="token string">'尚然'</span><span class="token punctuation">,</span>
        <span class="token string">'羿鳞'</span><span class="token punctuation">,</span> <span class="token string">'月鸿'</span><span class="token punctuation">,</span> <span class="token string">'健霖'</span><span class="token punctuation">,</span> <span class="token string">'鸿昊'</span><span class="token punctuation">,</span> <span class="token string">'竣杰'</span><span class="token punctuation">,</span> <span class="token string">'可顺'</span><span class="token punctuation">,</span> <span class="token string">'炯乐'</span><span class="token punctuation">,</span> <span class="token string">'俊彦'</span><span class="token punctuation">,</span> <span class="token string">'海沧'</span><span class="token punctuation">,</span> <span class="token string">'捷明'</span><span class="token punctuation">,</span>
        <span class="token string">'飞扬'</span><span class="token punctuation">,</span> <span class="token string">'杰辰'</span><span class="token punctuation">,</span> <span class="token string">'羽捷'</span><span class="token punctuation">,</span> <span class="token string">'曦晴'</span><span class="token punctuation">,</span> <span class="token string">'裕鸿'</span><span class="token punctuation">,</span> <span class="token string">'翌锦'</span><span class="token punctuation">,</span> <span class="token string">'沐宸'</span><span class="token punctuation">,</span> <span class="token string">'福同'</span><span class="token punctuation">,</span> <span class="token string">'旻驰'</span><span class="token punctuation">,</span> <span class="token string">'龙宁'</span><span class="token punctuation">,</span>
        <span class="token string">'文虹'</span><span class="token punctuation">,</span> <span class="token string">'义凡'</span><span class="token punctuation">,</span> <span class="token string">'广晨'</span><span class="token punctuation">,</span> <span class="token string">'宸滔'</span><span class="token punctuation">,</span> <span class="token string">'嘉岐'</span><span class="token punctuation">,</span> <span class="token string">'雅珺'</span><span class="token punctuation">,</span> <span class="token string">'睿明'</span><span class="token punctuation">,</span> <span class="token string">'皓轩'</span><span class="token punctuation">,</span> <span class="token string">'程天'</span><span class="token punctuation">,</span> <span class="token string">'子酝'</span><span class="token punctuation">,</span>
        <span class="token string">'艾康'</span><span class="token punctuation">,</span> <span class="token string">'如羽'</span><span class="token punctuation">,</span> <span class="token string">'冠玉'</span><span class="token punctuation">,</span> <span class="token string">'子歉'</span><span class="token punctuation">,</span> <span class="token string">'永昊'</span><span class="token punctuation">,</span> <span class="token string">'龙华'</span><span class="token punctuation">,</span> <span class="token string">'兆颜'</span><span class="token punctuation">,</span> <span class="token string">'奇文'</span><span class="token punctuation">,</span> <span class="token string">'月昕'</span><span class="token punctuation">,</span> <span class="token string">'裕锦'</span><span class="token punctuation">,</span>
        <span class="token string">'昂佳'</span><span class="token punctuation">,</span> <span class="token string">'昊浩'</span><span class="token punctuation">,</span> <span class="token string">'宇韬'</span><span class="token punctuation">,</span> <span class="token string">'睿焓'</span><span class="token punctuation">,</span> <span class="token string">'永译'</span><span class="token punctuation">,</span> <span class="token string">'鸿彬'</span><span class="token punctuation">,</span> <span class="token string">'颢霖'</span><span class="token punctuation">,</span> <span class="token string">'益彬'</span><span class="token punctuation">,</span> <span class="token string">'虹昊'</span><span class="token punctuation">,</span> <span class="token string">'飞悦'</span><span class="token punctuation">,</span>
        <span class="token string">'睿珏'</span><span class="token punctuation">,</span> <span class="token string">'?宵童'</span><span class="token punctuation">,</span> <span class="token string">'睿鸿'</span><span class="token punctuation">,</span> <span class="token string">'容冰'</span><span class="token punctuation">,</span> <span class="token string">'逸濠'</span><span class="token punctuation">,</span> <span class="token string">'楷岩'</span><span class="token punctuation">,</span> <span class="token string">'弘义'</span><span class="token punctuation">,</span> <span class="token string">'海萦'</span><span class="token punctuation">,</span> <span class="token string">'昊孺'</span><span class="token punctuation">,</span> <span class="token string">'梓铭'</span><span class="token punctuation">,</span>
        <span class="token string">'生钊'</span><span class="token punctuation">,</span> <span class="token string">'蓝玺'</span><span class="token punctuation">,</span> <span class="token string">'晨辕'</span><span class="token punctuation">,</span> <span class="token string">'宇菡'</span><span class="token punctuation">,</span> <span class="token string">'砚海'</span><span class="token punctuation">,</span> <span class="token string">'文揩'</span><span class="token punctuation">,</span> <span class="token string">'韬瑞'</span><span class="token punctuation">,</span> <span class="token string">'彦红'</span><span class="token punctuation">,</span> <span class="token string">'奕韦'</span><span class="token punctuation">,</span> <span class="token string">'清予'</span><span class="token punctuation">,</span>
        <span class="token string">'宁翼'</span><span class="token punctuation">,</span> <span class="token string">'冬睿'</span><span class="token punctuation">,</span> <span class="token string">'锦昌'</span><span class="token punctuation">,</span> <span class="token string">'烨宁'</span><span class="token punctuation">,</span> <span class="token string">'昌权'</span><span class="token punctuation">,</span> <span class="token string">'国研'</span><span class="token punctuation">,</span> <span class="token string">'德运'</span><span class="token punctuation">,</span> <span class="token string">'孝清'</span><span class="token punctuation">,</span> <span class="token string">'佳阳'</span><span class="token punctuation">,</span> <span class="token string">'凯玮'</span><span class="token punctuation">,</span>
        <span class="token string">'正真'</span><span class="token punctuation">,</span> <span class="token string">'民云'</span><span class="token punctuation">,</span> <span class="token string">'昕冶'</span><span class="token punctuation">,</span> <span class="token string">'力威'</span><span class="token punctuation">,</span> <span class="token string">'帅欣'</span><span class="token punctuation">,</span> <span class="token string">'知淳'</span><span class="token punctuation">,</span> <span class="token string">'烨飞'</span><span class="token punctuation">,</span> <span class="token string">'兴远'</span><span class="token punctuation">,</span> <span class="token string">'子墨'</span><span class="token punctuation">,</span> <span class="token string">'澄欣'</span><span class="token punctuation">,</span>
        <span class="token string">'烨煊'</span><span class="token punctuation">,</span> <span class="token string">'悦勤'</span><span class="token punctuation">,</span> <span class="token string">'晨津'</span><span class="token punctuation">,</span> <span class="token string">'博宏'</span><span class="token punctuation">,</span> <span class="token string">'育萌'</span><span class="token punctuation">,</span> <span class="token string">'羽炫'</span><span class="token punctuation">,</span> <span class="token string">'绍钧'</span><span class="token punctuation">,</span> <span class="token string">'睿昌'</span><span class="token punctuation">,</span> <span class="token string">'泓千'</span><span class="token punctuation">,</span> <span class="token string">'颢炜'</span><span class="token punctuation">,</span>
        <span class="token string">'虹金'</span><span class="token punctuation">,</span> <span class="token string">'筠航'</span><span class="token punctuation">,</span> <span class="token string">'元甲'</span><span class="token punctuation">,</span> <span class="token string">'星明'</span><span class="token punctuation">,</span> <span class="token string">'景涛'</span><span class="token punctuation">,</span> <span class="token string">'铭虹'</span><span class="token punctuation">,</span> <span class="token string">'德本'</span><span class="token punctuation">,</span> <span class="token string">'向辉'</span><span class="token punctuation">,</span> <span class="token string">'基翔'</span><span class="token punctuation">,</span> <span class="token string">'家易'</span><span class="token punctuation">,</span>
        <span class="token string">'欣鹏'</span><span class="token punctuation">,</span> <span class="token string">'羽荃'</span><span class="token punctuation">,</span> <span class="token string">'泽容'</span><span class="token punctuation">,</span> <span class="token string">'弘亮'</span><span class="token punctuation">,</span> <span class="token string">'尚廷'</span><span class="token punctuation">,</span> <span class="token string">'轩梓'</span><span class="token punctuation">,</span> <span class="token string">'甫津'</span><span class="token punctuation">,</span> <span class="token string">'彬楷'</span><span class="token punctuation">,</span> <span class="token string">'寅飞'</span><span class="token punctuation">,</span> <span class="token string">'愉君'</span><span class="token punctuation">,</span>
        <span class="token string">'阳平'</span><span class="token punctuation">,</span> <span class="token string">'誉杰'</span><span class="token punctuation">,</span> <span class="token string">'钦昭'</span><span class="token punctuation">,</span> <span class="token string">'蕴藉'</span><span class="token punctuation">,</span> <span class="token string">'羽程'</span><span class="token punctuation">,</span> <span class="token string">'宏海'</span><span class="token punctuation">,</span> <span class="token string">'涵畅'</span><span class="token punctuation">,</span> <span class="token string">'光浩'</span><span class="token punctuation">,</span> <span class="token string">'令沂'</span><span class="token punctuation">,</span> <span class="token string">'浩浩'</span><span class="token punctuation">,</span>
        <span class="token string">'睿锦'</span><span class="token punctuation">,</span> <span class="token string">'易泽'</span><span class="token punctuation">,</span> <span class="token string">'俊康'</span><span class="token punctuation">,</span> <span class="token string">'家文'</span><span class="token punctuation">,</span> <span class="token string">'晨元'</span><span class="token punctuation">,</span> <span class="token string">'语洋'</span><span class="token punctuation">,</span> <span class="token string">'裕宏'</span><span class="token punctuation">,</span> <span class="token string">'梓榛'</span><span class="token punctuation">,</span> <span class="token string">'阳嘉'</span><span class="token punctuation">,</span> <span class="token string">'恒展'</span><span class="token punctuation">,</span>
        <span class="token string">'雨远'</span><span class="token punctuation">,</span> <span class="token string">'哲伊'</span><span class="token punctuation">,</span> <span class="token string">'逸江'</span><span class="token punctuation">,</span> <span class="token string">'丰源'</span><span class="token punctuation">,</span> <span class="token string">'学东'</span><span class="token punctuation">,</span> <span class="token string">'奇岩'</span><span class="token punctuation">,</span> <span class="token string">'浩财'</span><span class="token punctuation">,</span> <span class="token string">'和蔼'</span><span class="token punctuation">,</span> <span class="token string">'红言'</span><span class="token punctuation">,</span> <span class="token string">'瑞赫'</span><span class="token punctuation">,</span>
        <span class="token string">'森圆'</span><span class="token punctuation">,</span> <span class="token string">'欣赢'</span><span class="token punctuation">,</span> <span class="token string">'梓鸿'</span><span class="token punctuation">,</span> <span class="token string">'博明'</span><span class="token punctuation">,</span> <span class="token string">'铭育'</span><span class="token punctuation">,</span> <span class="token string">'颢硕'</span><span class="token punctuation">,</span> <span class="token string">'宇烯'</span><span class="token punctuation">,</span> <span class="token string">'宇如'</span><span class="token punctuation">,</span> <span class="token string">'淳炎'</span><span class="token punctuation">,</span> <span class="token string">'源承'</span><span class="token punctuation">,</span>
        <span class="token string">'斌彬'</span><span class="token punctuation">,</span> <span class="token string">'飞沉'</span><span class="token punctuation">,</span> <span class="token string">'鸿璐'</span><span class="token punctuation">,</span> <span class="token string">'昊弘'</span>
      <span class="token punctuation">]</span>

      lastNames <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeDup</span><span class="token punctuation">(</span>lastNames<span class="token punctuation">)</span>

      <span class="token keyword">var</span> firstLength <span class="token operator">=</span> firstNames<span class="token punctuation">.</span>length
      <span class="token keyword">var</span> lastLength <span class="token operator">=</span> lastNames<span class="token punctuation">.</span>length

      <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> firstLength<span class="token punctuation">)</span>
      <span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> lastLength<span class="token punctuation">)</span>
      <span class="token keyword">var</span> name <span class="token operator">=</span> firstNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> lastNames<span class="token punctuation">[</span>j<span class="token punctuation">]</span>

      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 去重</span>
    <span class="token function">removeDup</span> <span class="token punctuation">(</span><span class="token parameter">names</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> names<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
          obj<span class="token punctuation">[</span>names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>less<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
<span class="token selector">.container</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 39%<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
  <span class="token selector">.message-container</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
    <span class="token selector">.message-item</span> <span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 4px 0px<span class="token punctuation">;</span>
      <span class="token selector">.image-left</span> <span class="token punctuation">{</span>
        <span class="token property">flex</span><span class="token punctuation">:</span> 0 40px<span class="token punctuation">;</span>
        <span class="token selector">.name-image</span> <span class="token punctuation">{</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
          <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
          <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
          <span class="token property">background-color</span><span class="token punctuation">:</span> #037df3<span class="token punctuation">;</span>
          <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
          <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
          <span class="token property">line-height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
          <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.text-right</span> <span class="token punctuation">{</span>
        <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token selector">.name</span> <span class="token punctuation">{</span>
          <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
          <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.text</span> <span class="token punctuation">{</span>
          <span class="token property">color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.my-message</span> <span class="token punctuation">{</span>
      <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
      <span class="token property">flex-direction</span><span class="token punctuation">:</span> row-reverse<span class="token punctuation">;</span>
      <span class="token property">padding-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token selector">.image-left</span> <span class="token punctuation">{</span>
        <span class="token selector">.name-image</span> <span class="token punctuation">{</span>
          <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.text-right</span> <span class="token punctuation">{</span>
        <span class="token selector">.name</span> <span class="token punctuation">{</span>
          <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.text</span> <span class="token punctuation">{</span>
          <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.tip</span> <span class="token punctuation">{</span>
      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 4px 0px<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #BDBDBD<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.button-container</span> <span class="token punctuation">{</span>
    <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">::-webkit-scrollbar</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token comment">/*对垂直流动条有效*/</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token comment">/*对水平流动条有效*/</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/*定义滑块颜色、内阴影及圆角*/</span>
  <span class="token selector">::-webkit-scrollbar-thumb</span><span class="token punctuation">{</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span>
    <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> inset 0 0 6px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>.3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #E8E8E8<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br></div></div><p>完成上述代码后，基本能够实现信息的发送与接收，后面我们对界面进行优化，我们主要优化点有两个：</p>
<ul>
<li>如何判断哪条信息是我发的，并且以不同方式展示出来</li>
<li>怎样才能让最新信息始终展示出来</li>
</ul>
<p>对于第一个点，我们采取姓名判断，我们定义两套样式，分别为 <code>message-item</code> (他人发送消息)与 <code>message-item my-message</code> (自己发送消息)，在 <code>html</code> 循环渲染的时候判断当前发送者名称或身份标识符与我是否相同，如果相同则使用 <code>message-item my-message</code> 样式渲染，代码如下：</p>
<p>web:</p>
<div class="language-vue ext-vue line-numbers-mode"><pre v-pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.type === <span class="token punctuation">'</span>sendMessage<span class="token punctuation">'</span><span class="token punctuation">"</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getMessageClass(item)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name-image<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name | nameFilter }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.name }}：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">effect</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>plain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item.message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>JavaScript:</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// 设置信息样式</span>
<span class="token function">getMessageClass</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>myName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'message-item my-message'</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'message-item'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对于第二点，我们接收到新的信息的时候，主动将滚动条滚动到最低端即可，代码如下：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// 监听服务端的消息“msg”</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 需要等待新信息渲染完成之后才能将设置滚动条位置</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>到此，我们聊天室，算是完成了基本功能：</p>
<p><img src="https://i.loli.net/2021/10/13/4DZnzJgHcq9LvSu.png" alt="image-202110081924496"></p>
<p>在 <code>WebSoket</code> 中，没有任何事件标识符，那 <code>WebSoket</code> 怎样实现前后端多个事件交流呢？答案很简单，我们在客户端请求与服务端推送数据中添加事件标识，然后前后端约定标识统一即可，因此通过 <code>WebSoket</code> 实现多种事件交互模型如下：</p>
<p><img src="https://i.loli.net/2021/10/13/S7bWGLY2tF3DxaH.png" alt="WebSoket多事件处.png"></p>
<h3 id="sse" tabindex="-1"><a class="header-anchor" href="#sse" aria-hidden="true">#</a> SSE</h3>
<p><code>SSE</code> （ Server-sent Events ）是 <code>WebSocket</code> 的一种轻量代替方案，基于 HTTP 协议。</p>
<p>严格来说，HTTP协议只能由客户端发起请求，并且在请求结束后关闭连接，但是如果我们发起一个请求的时候，服务器告诉客户端我要发送一个流信息，则客户端连接就会一直打开，而 <code>SSE</code> 使用的就是这个原理。</p>
<p>如上所述，可见 <code>SSE</code> 只有服务器到客户端的单向交互，且较为轻量（相当于一个接口），因此我们可以用它实现一些后端消息推送的接收等等。</p>
<p>接下来，我们将使用 <code>SSE</code> 实现一个对系统资源使用状态监控的界面，以此进一步了解 <code>SSE</code> 的使用方式。</p>
<h4 id="准备-1" tabindex="-1"><a class="header-anchor" href="#准备-1" aria-hidden="true">#</a> 准备</h4>
<p>前后端代码暂时就再不新建一个项目了，我们还是使用原来的。</p>
<p>首先我们需要分析一下后端状态推送的需求，简单来说就是后端不断查询最新状态，然后返回给前端，那么我们什么时候查询呢，最开始的时候我将查询逻辑放置在接口中，然后发现这样的话我每连一次，都要多一套状态查询，如果连接数量级过大，服务器压力会骤增，所以后续将查询状态的方法放置在全局，每间隔一秒钟查询一次，接口中，每一秒钟项客户端发送一次，这样的话在保证数据实时的前提下，降低了服务器的查询次数。</p>
<p>完成了方案的设计，我们开始实现后端的检索及推送功能：</p>
<p>首先我们怎样获取服务器资源使用信息呢？</p>
<p><code>node</code> 给我们提供了便捷的 <code>api</code> : <code>os</code> , <code>os</code> 模块提供了与操作系统相关的实用方法和属性，我们可以通过其中方法获取当前系统多种属性。</p>
<p>我们在后端代码 <code>index.js</code> 中插入全局的服务器监听程序：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> serviceMessage <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 每隔1秒钟监听当前服务器情况</span>
<span class="token keyword">let</span> serviceInterval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  serviceMessage <span class="token operator">=</span> <span class="token punctuation">{</span>
    free<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">freemem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 闲置内存</span>
    total<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">totalmem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 总内存</span>
    used<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">totalmem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> os<span class="token punctuation">.</span><span class="token function">freemem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 使用内存</span>
    usageRate<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">totalmem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> os<span class="token punctuation">.</span><span class="token function">freemem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> os<span class="token punctuation">.</span><span class="token function">totalmem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 内存使用率</span>
    platform<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 平台</span>
    type<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 操作系统名称</span>
    runTime<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">uptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 系统正常运行时间</span>
    <span class="token operator">...</span>os<span class="token punctuation">.</span><span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 当前有效用户的信息</span>
    cpuInfo<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// CPU 内核的信息</span>
    hostName<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">hostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 操作系统的主机名</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>创建 <code>SSE</code> 接口：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getServerMessage'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 声明接口类型为SSE</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/event-stream"</span><span class="token punctuation">,</span>
    <span class="token string">"Cache-Control"</span><span class="token operator">:</span> <span class="token string">"no-cache"</span><span class="token punctuation">,</span>
    <span class="token string">"Connection"</span><span class="token operator">:</span> <span class="token string">"keep-alive"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 间隔1秒钟向前端推送服务器信息</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送信息以 \n\n 截断，返回数据中必须携带，不然客户端认为当前一次事件未结束，会一直等待</span>
    <span class="token comment">// 请求前必须添加 data: ，否则前端无法接收</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"data:"</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>serviceMessage<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>需要注意的是，我们每发一段消息的时候需要在后面加上 <code>\n\n</code> 字符，客户端通过该字符将流信息截断，如果不添加的话，客户端会认为本条信息未发送完成，导致接口访问后一直接收不到信息。</p>
<p>此时我们可以直接在浏览器输入地址：<code>localhost:3001/getServerMessage</code> 访问接口，访问结果如下：</p>
<p><img src="https://i.loli.net/2021/10/13/GuMVwJXo3tYHNmq.png" alt="image-2021100820174197"></p>
<p>后端每隔一秒钟推送的数据都可以展现到浏览器上，而右上角显示请求一直在等待中，说明 <code>HTTP</code> 连接一直都未断开。</p>
<p>接下来，我们简单的实现一下前端的信息展示：</p>
<p>首先在 <code>create</code> 的时候，我们请求一下 <code>SSE</code> 请求：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token function">createSSE</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sseSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:3001/getServerMessage'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sseSource<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>computeData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 将使用率存入数组，做表格展示使用</span>
        <span class="token keyword">let</span> newDate <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>usageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>newDate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>computeData<span class="token punctuation">.</span>usageRate<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">// 刷新图标</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>charts<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            series<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    data<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usageList
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>需要注意的是，此时我们连接请求是会失败的，因为跨域了，所以我们要在后端加上允许跨域代码（index.js）：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Headers"</span><span class="token punctuation">,</span> <span class="token string">"X-Requested-With"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Methods"</span><span class="token punctuation">,</span><span class="token string">"PUT,POST,GET,DELETE,OPTIONS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span><span class="token string">' 3.2.1'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>接下来便是界面的展示，在这里就不多赘述，直接上代码：</p>
<div class="language-vue ext-vue line-numbers-mode"><pre v-pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sse-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memory-message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in computeList<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> {{ item.name }}: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> {{ computeData[item.key] }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memory-message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in resourceList<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> {{ item.name }}: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.key !== <span class="token punctuation">'</span>usageRate<span class="token punctuation">'</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> {{ computeData[item.key] | transformMemory }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> {{ computeData[item.key] }}% <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> echarts <span class="token keyword">from</span> <span class="token string">'echarts'</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">'内存使用率'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  tooltip<span class="token operator">:</span> <span class="token punctuation">{</span>
    trigger<span class="token operator">:</span> <span class="token string">'axis'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  xAxis<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'时间'</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">'category'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  yAxis<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'使用率(%)'</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">'value'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">max</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>max <span class="token operator">+</span> <span class="token number">0.01</span> <span class="token operator">*</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>min<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">min</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>min <span class="token operator">-</span> <span class="token number">0.01</span> <span class="token operator">*</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>min<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    minInterval<span class="token operator">:</span> <span class="token number">0.5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  series<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'使用率'</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token comment">// 图类型</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    smooth<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'SSE'</span><span class="token punctuation">,</span>
  filters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">transformMemory</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> memoryList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'KB'</span><span class="token punctuation">,</span> <span class="token string">'MB'</span><span class="token punctuation">,</span> <span class="token string">'GB'</span><span class="token punctuation">,</span> <span class="token string">'TB'</span><span class="token punctuation">]</span>
      <span class="token keyword">let</span> memory <span class="token operator">=</span> value
      <span class="token keyword">let</span> memoryStr <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> memoryList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> item <span class="token operator">=</span> memoryList<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>memory <span class="token operator">></span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            memory <span class="token operator">=</span> memory <span class="token operator">/</span> <span class="token number">1024</span>
            memory <span class="token operator">=</span> memory<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            memoryStr <span class="token operator">=</span> memory <span class="token operator">+</span> item
            <span class="token keyword">break</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> memoryStr
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'--'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sseSource<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      computeData<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      resourceList<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">闲置内存</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          key<span class="token operator">:</span> <span class="token string">'free'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">使用内存</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          key<span class="token operator">:</span> <span class="token string">'used'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">内存总量</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          key<span class="token operator">:</span> <span class="token string">'total'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">内存使用率</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          key<span class="token operator">:</span> <span class="token string">'usageRate'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      computeList<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'系统平台'</span><span class="token punctuation">,</span>
          key<span class="token operator">:</span> <span class="token string">'platform'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'系统正常运行时间（S）'</span><span class="token punctuation">,</span>
          key<span class="token operator">:</span> <span class="token string">'runTime'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
          key<span class="token operator">:</span> <span class="token string">'username'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      charts<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      usageList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSSE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createChars</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">createSSE</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>sseSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:3001/getServerMessage'</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>sseSource<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>computeData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> newDate <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>usageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>newDate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>computeData<span class="token punctuation">.</span>usageRate<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>charts<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          series<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              data<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usageList
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">createChars</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>charts <span class="token operator">=</span> echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>charts<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sseSource<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>less<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
<span class="token selector">.sse-container</span> <span class="token punctuation">{</span>
  <span class="token selector">.memory-message</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 70%<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token selector">.message-head, .message-body</span> <span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
      <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
      <span class="token selector">.title</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 40%<span class="token punctuation">;</span>
        <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.content</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 30%<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.map</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
    <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br></div></div><p>最后我们看到的界面如下图所示：</p>
<p><img src="https://i.loli.net/2021/10/13/KnBOuFTW4YwxzNf.png" alt="image-2021100820470104"></p>
<h2 id="结论" tabindex="-1"><a class="header-anchor" href="#结论" aria-hidden="true">#</a> 结论</h2>
<p>对于连接方式，<code>WebSoket</code> 是基于 <code>TCP</code> 协议的连接，与 <code>HTTP</code> 协议有着良好的兼容性，没有同源限制，且为双向通信，所以我们可以在很多偏向实时的、双向的频繁操作的情况下使用 <code>WebSoket</code> 例如监控视频播放插件中，我们可以使用它进行实时的操作，保证请求及反馈的实时性。而 <code>SSE</code> 相对比，显得更轻量，我们不需要另外开辟一个端口去实现，基于其单向交互的特性，我们可以用它来实现一些性能监控或状态实时获取等业务场景（<code>Vue</code> 热更新也是使用 <code>SSE</code> 做到代码更新的实时推送的）。简单来说， <code>WebSoket</code> 适合复杂的前后端实时且频繁交互，使用范围广但相较于 <code>SSE</code> 则偏重量级； <code>SSE</code> 则更适合一些简单的后端状态获取，但实现更为轻量；</p>
<p>最后则是两个技术都要注意的一点：<strong>连接限制</strong></p>
<p>对于 <code>WebSoket</code> ，各个浏览器限制为（此限制似乎只限于原生连接，如果使用 <code>soket.io</code> 似乎没有限制了 ）：</p>
<table>
<thead>
<tr>
<th>浏览器</th>
<th>限制</th>
</tr>
</thead>
<tbody>
<tr>
<td>IE（IE9以下不支持）</td>
<td>6</td>
</tr>
<tr>
<td>chrome</td>
<td>6</td>
</tr>
<tr>
<td>firefox</td>
<td>6</td>
</tr>
<tr>
<td>Safari</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>对于 <code>SSE</code>  ,各浏览器限制为：</p>
<table>
<thead>
<tr>
<th>浏览器</th>
<th>限制</th>
</tr>
</thead>
<tbody>
<tr>
<td>IE11</td>
<td>13</td>
</tr>
<tr>
<td>Chrome</td>
<td>6</td>
</tr>
<tr>
<td>火狐</td>
<td>6</td>
</tr>
<tr>
<td>Safari</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>上述两个实例已上传到我的 <code>git</code> 上，大家可自取使用，地址为：</p>
<p>前端：https://github.com/shiyingjieGra/websoketWeb</p>
<p>后端：https://github.com/shiyingjieGra/websoketNode</p>
<p>本篇内容参考文档有：</p>
<p>[WebSocket入门教程（三）-- WebSocket实例：实时获取服务器内存使用情况](WebSocket入门教程（三）-- WebSocket实例：实时获取服务器内存使用情况)</p>
<p><a href="https://blog.csdn.net/u010136741/article/details/51612594?spm=1001.2014.3001.5501" target="_blank" rel="noopener noreferrer">WebSocket入门教程（五）-- WebSocket实例：简单多人聊天室<OutboundLink/></a></p>
<p><a href="https://my.oschina.net/shisl/blog/4773984" target="_blank" rel="noopener noreferrer">Browser connection limitations（浏览器长连接个数限制）解决方案<OutboundLink/></a></p>
</template>
